<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Token Management</title>
    <!-- é˜²æ­¢é¡µé¢é—ªçƒï¼šåœ¨æ¸²æŸ“å‰æ ¹æ®TabçŠ¶æ€è®¾ç½®åˆå§‹æ˜¾ç¤º -->
    <script>
        (function () {
            // åˆå§‹çŠ¶æ€ï¼šauth-checking è¡¨ç¤ºæ­£åœ¨éªŒè¯ç™»å½•çŠ¶æ€
            // éªŒè¯å®Œæˆåä¼šå˜æˆ auth-ready + logged-in æˆ– auth-ready
            var currentTab = localStorage.getItem('currentTab') || 'tokens';
            var classes = ['auth-checking'];
            if (currentTab === 'settings') classes.push('tab-settings');
            if (currentTab === 'logs') classes.push('tab-logs');
            document.documentElement.className = classes.join(' ');
            // æ£€æµ‹å­—ä½“åŠ è½½
            if ('fonts' in document) {
                document.fonts.ready.then(function () {
                    document.documentElement.classList.add('fonts-loaded');
                });
            } else {
                // åå¤‡æ–¹æ¡ˆï¼šå»¶è¿Ÿæ·»åŠ 
                setTimeout(function () {
                    document.documentElement.classList.add('fonts-loaded');
                }, 1000);
            }
        })();
    </script>
    <style>
        /* éªŒè¯ä¸­çŠ¶æ€ï¼šéšè—ç™»å½•æ¡†å’Œä¸»å†…å®¹ï¼Œæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ */
        html.auth-checking #loginForm,
        html.auth-checking #mainContent {
            display: none !important;
        }

        html.auth-checking #authLoading {
            display: flex !important;
        }

        /* éªŒè¯å®Œæˆåï¼šéšè—åŠ è½½æŒ‡ç¤ºå™¨ */
        html.auth-ready #authLoading {
            display: none !important;
        }

        /* ç™»å½•çŠ¶æ€æ˜¾ç¤ºæ§åˆ¶ */
        .logged-in #loginForm {
            display: none !important;
        }

        .logged-in #mainContent {
            display: flex !important;
        }

        html.auth-ready:not(.logged-in) #loginForm {
            display: block !important;
        }

        html.auth-ready:not(.logged-in) #mainContent {
            display: none !important;
        }

        /* TabçŠ¶æ€ç®¡ç† */
        html.tab-settings #tokensPage {
            display: none !important;
        }

        html.tab-settings #settingsPage {
            display: block !important;
        }

        html.tab-settings #logsPage {
            display: none !important;
        }

        html.tab-settings .tab[data-tab="tokens"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-settings .tab[data-tab="settings"] {
            background: var(--primary, #4f46e5) !important;
            color: white !important;
        }

        html.tab-settings .tab[data-tab="logs"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-logs #tokensPage {
            display: none !important;
        }

        html.tab-logs #settingsPage {
            display: none !important;
        }

        html.tab-logs #logsPage {
            display: flex !important;
        }

        html.tab-logs #geminicliPage {
            display: none !important;
        }

        html.tab-logs .tab[data-tab="tokens"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-logs .tab[data-tab="settings"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-logs .tab[data-tab="logs"] {
            background: var(--primary, #4f46e5) !important;
            color: white !important;
        }

        html.tab-logs .tab[data-tab="geminicli"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        /* Gemini CLI Tab çŠ¶æ€ */
        html.tab-geminicli #tokensPage {
            display: none !important;
        }

        html.tab-geminicli #settingsPage {
            display: none !important;
        }

        html.tab-geminicli #logsPage {
            display: none !important;
        }

        html.tab-geminicli #geminicliPage {
            display: block !important;
        }

        html.tab-geminicli .tab[data-tab="tokens"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-geminicli .tab[data-tab="settings"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-geminicli .tab[data-tab="logs"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-geminicli .tab[data-tab="geminicli"] {
            background: var(--primary, #4f46e5) !important;
            color: white !important;
        }

        html.tab-settings #geminicliPage {
            display: none !important;
        }

        html.tab-settings .tab[data-tab="geminicli"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        /* åŠ è½½æŒ‡ç¤ºå™¨æ ·å¼ */
        #authLoading {
            display: none;
            position: fixed;
            inset: 0;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
            background: var(--bg, #f8fafc);
        }

        #authLoading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border, #e2e8f0);
            border-top-color: var(--primary, #0891b2);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        #authLoading .loading-text {
            color: var(--text-light, #64748b);
            font-size: 0.875rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
    <!-- ä¸»æ ·å¼è¡¨ - ä¼˜å…ˆåŠ è½½ -->
    <link rel="stylesheet" href="style.css">
    <!-- é¢„è¿æ¥å­—ä½“æœåŠ¡å™¨ -->
    <link rel="preconnect" href="https://font.sec.miui.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- å­—ä½“å¼‚æ­¥åŠ è½½ - ä¸é˜»å¡æ¸²æŸ“ -->
    <link rel="stylesheet"
        href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap"
        media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap"
        media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet"
            href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap">
    </noscript>
</head>

<body>
    <!-- éªŒè¯ç™»å½•çŠ¶æ€æ—¶çš„åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="authLoading">
        <div class="spinner"></div>
        <div class="loading-text">Verifying login status...</div>
    </div>

    <div class="container">
        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm" class="login-form">
            <h2>Token Management</h2>
            <form id="login">
                <div class="form-group">
                    <label>ğŸ‘¤ Username</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>ğŸ”‘ Password</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit">Login</button>
            </form>
        </div>

        <!-- ä¸»å†…å®¹ -->
        <div id="mainContent" class="main-content hidden">
            <div class="header">
            <div class="tabs">
                <button class="tab active" data-tab="tokens" onclick="switchTab('tokens')"><span
                        class="tab-icon">ğŸ¯</span><span class="tab-text">Token</span></button>
                <button class="tab" data-tab="geminicli" onclick="switchTab('geminicli')"><span
                        class="tab-icon">ğŸ’</span><span class="tab-text">CLI</span></button>
                <button class="tab" data-tab="settings" onclick="switchTab('settings')"><span
                        class="tab-icon">âš™ï¸</span><span class="tab-text">Settings</span></button>
                <button class="tab" data-tab="logs" onclick="switchTab('logs')"><span
                        class="tab-icon">ğŸ“‹</span><span class="tab-text">Logs</span></button>
            </div>
                <div class="header-right">
                    <button onclick="logout()">ğŸšª Logout</button>
                </div>
            </div>
            <div class="content">
                <!-- Tokenç®¡ç†é¡µé¢ -->
                <div id="tokensPage">
                    <!-- ç»Ÿè®¡å¡ç‰‡ + æ“ä½œæŒ‰é’® -->
                    <div class="top-bar">
                        <div class="stats-inline">
                            <div class="stat-item clickable active" onclick="filterTokens('all')">
                                <span class="stat-num" id="totalTokens">0</span>
                                <span class="stat-text">Total</span>
                            </div>
                            <div class="stat-item success clickable" onclick="filterTokens('enabled')">
                                <span class="stat-num" id="enabledTokens">0</span>
                                <span class="stat-text">Enabled</span>
                            </div>
                            <div class="stat-item danger clickable" onclick="filterTokens('disabled')">
                                <span class="stat-num" id="disabledTokens">0</span>
                                <span class="stat-text">Disabled</span>
                            </div>
                            <button type="button" class="action-toggle-btn" id="actionToggleBtn"
                                onclick="toggleActionBar()" title="Collapse action buttons">â–¾</button>
                        </div>
                        <div class="action-btns" id="actionBar">
                            <button type="button" onclick="showOAuthModal()" class="btn btn-success btn-sm">ğŸ”
                                OAuth</button>
                            <button type="button" onclick="toggleSensitiveInfo()" class="btn btn-secondary btn-sm"
                                id="toggleSensitiveBtn" title="Click to show sensitive information">ğŸ™ˆ Hide</button>
                            <button type="button" onclick="refreshAllQuotas()" class="btn btn-info btn-sm"
                                id="refreshQuotasBtn">ğŸ“Š Refresh Quota</button>
                            <button type="button" onclick="batchFetchProjectIds()" class="btn btn-info btn-sm"
                                title="Batch fetch Project IDs for all enabled tokens">ğŸ” Batch Fetch</button>
                            <button type="button" onclick="loadTokens()" class="btn btn-warning btn-sm">ğŸ”„ Reload</button>
                            <button type="button" onclick="exportTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="Export Tokens">ğŸ“¤ Export</button>
                            <button type="button" onclick="importTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="Add/Import Tokens">ğŸ“¥ Import</button>
                        </div>
                    </div>

                    <!-- Tokenç½‘æ ¼ -->
                    <div id="tokenList" class="token-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“¦</div>
                            <div class="empty-state-text">No Tokens</div>
                            <div class="empty-state-hint">Click the OAuth button above to add tokens</div>
                        </div>
                    </div>
                </div>

                <!-- Gemini CLI é¡µé¢ -->
                <div id="geminicliPage" class="hidden">
                    <!-- ç»Ÿè®¡å¡ç‰‡ + æ“ä½œæŒ‰é’® -->
                    <div class="top-bar">
                        <div class="stats-inline">
                            <div class="stat-item clickable active" onclick="filterGeminiCliTokens('all')">
                                <span class="stat-num" id="geminicliTotalTokens">0</span>
                                <span class="stat-text">Total</span>
                            </div>
                            <div class="stat-item success clickable" onclick="filterGeminiCliTokens('enabled')">
                                <span class="stat-num" id="geminicliEnabledTokens">0</span>
                                <span class="stat-text">Enabled</span>
                            </div>
                            <div class="stat-item danger clickable" onclick="filterGeminiCliTokens('disabled')">
                                <span class="stat-num" id="geminicliDisabledTokens">0</span>
                                <span class="stat-text">Disabled</span>
                            </div>
                        </div>
                        <div class="action-btns">
                            <button type="button" onclick="showGeminiCliOAuthModal()" class="btn btn-success btn-sm">ğŸ”
                                OAuth</button>
                            <button type="button" onclick="toggleSensitiveInfo()" class="btn btn-secondary btn-sm"
                                title="Click to show sensitive information">ğŸ™ˆ Hide</button>
                            <button type="button" onclick="reloadGeminiCliTokens()" class="btn btn-warning btn-sm">ğŸ”„ Reload</button>
                            <button type="button" onclick="exportGeminiCliTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="Export Tokens">ğŸ“¤ Export</button>
                            <button type="button" onclick="importGeminiCliTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="Add/Import Tokens">ğŸ“¥ Import</button>
                        </div>
                    </div>

                    <!-- Tokenç½‘æ ¼ -->
                    <div id="geminicliTokenList" class="token-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“¦</div>
                            <div class="empty-state-text">No Gemini CLI Tokens</div>
                            <div class="empty-state-hint">Click the OAuth button above to add tokens</div>
                        </div>
                    </div>
                </div>

                <!-- æ—¥å¿—é¡µé¢ -->
                <div id="logsPage" class="hidden">
                    <div class="logs-top-bar">
                        <div class="logs-top-row">
                            <div id="logStats" class="log-stats">
                                <!-- æ—¥å¿—ç»Ÿè®¡å°†ç”± JS æ¸²æŸ“ -->
                            </div>
                        </div>
                        <div class="logs-second-row">
                            <div class="log-search">
                                <input type="text" id="logSearchInput" placeholder="Search logs..."
                                    oninput="searchLogs(this.value)">
                            </div>
                            <div class="log-action-btns">
                                <button id="autoRefreshBtn" class="btn btn-sm btn-secondary"
                                    onclick="toggleAutoRefresh()" title="Auto refresh logs every 3 seconds">ğŸ”„ Auto Refresh</button>
                                <button class="btn btn-sm btn-info" onclick="loadLogs(); loadLogStats();"
                                    title="Manually refresh logs">â†» Refresh</button>
                                <button class="btn btn-sm" style="background: var(--primary);" onclick="exportLogs()"
                                    title="Export logs as text file">ğŸ“¤ Export</button>
                                <button class="btn btn-sm btn-danger" onclick="clearLogs()" title="Clear all logs">ğŸ—‘ï¸
                                    Clear</button>
                            </div>
                        </div>
                    </div>
                    <div class="log-container">
                        <div id="logList" class="log-list">
                            <div class="log-empty">
                                <div class="log-empty-icon">ğŸ“‹</div>
                                <div class="log-empty-text">Loading...</div>
                            </div>
                        </div>
                    </div>
                    <button id="loadMoreLogsBtn" class="btn btn-secondary load-more-btn" onclick="loadMoreLogs()"
                        style="display: none;">Load More</button>
                </div>

                <!-- è®¾ç½®é¡µé¢ -->
                <div id="settingsPage" class="hidden">
                    <form id="configForm" class="config-form">
                        <div class="settings-layout">
                            <aside class="settings-nav">
                                <div class="settings-search">
                                    <input type="text" id="settingsSearch" placeholder="Search settings..."
                                        oninput="filterSettings(this.value)">
                                </div>
                                <select class="settings-section-select" id="settingsSectionSelect"
                                    onchange="setActiveSettingSection(this.value, true)">
                                    <option value="section-server">ğŸ–¥ï¸ Server</option>
                                    <option value="section-model">ğŸ›ï¸ Model Parameters</option>
                                    <option value="section-rotation">ğŸ”„ Polling & Performance</option>
                                    <option value="section-security">ğŸ›¡ï¸ Security Management</option>
                                </select>
                                <div class="settings-nav-list">
                                    <button type="button" class="settings-nav-item" data-target="section-server"
                                        onclick="setActiveSettingSection('section-server', true)">ğŸ–¥ï¸ Server</button>
                                    <button type="button" class="settings-nav-item" data-target="section-model"
                                        onclick="setActiveSettingSection('section-model', true)">ğŸ›ï¸ Model Parameters</button>
                                    <button type="button" class="settings-nav-item" data-target="section-rotation"
                                        onclick="setActiveSettingSection('section-rotation', true)">ğŸ”„ Polling & Performance</button>
                                    <button type="button" class="settings-nav-item" data-target="section-security"
                                        onclick="setActiveSettingSection('section-security', true)">ğŸ›¡ï¸ Security Management</button>
                                </div>
                            </aside>
                            <div class="settings-content">
                                <div class="config-grid">
                                    <!-- æœåŠ¡å™¨é…ç½® -->
                                    <div class="config-section" id="section-server">
                                        <h4>ğŸ–¥ï¸ Server</h4>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Port</label>
                                                <input type="number" name="PORT" placeholder="8045">
                                            </div>
                                            <div class="form-group compact">
                                                <label>Listen Address</label>
                                                <input type="text" name="HOST" placeholder="0.0.0.0">
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>API Environment <span class="help-tip"
                                                    data-tooltip="Choose between sandbox or production API environment">?</span></label>
                                            <select name="API_USE" id="apiUseSelect">
                                                <option value="sandbox">Sandbox (Testing)</option>
                                                <option value="production">Production</option>
                                            </select>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Max Request Size</label>
                                                <input type="text" name="MAX_REQUEST_SIZE" placeholder="500mb">
                                            </div>
                                            <div class="form-group compact">
                                                <label>API Key</label>
                                                <input type="password" name="API_KEY" placeholder="Leave empty to disable verification">
                                            </div>
                                        </div>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>Skip Verification <span class="help-tip"
                                                        data-tooltip="Skip ProjectId fetching, generate randomly (Pro accounts only)">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="SKIP_PROJECT_ID_FETCH">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>Native Axios <span class="help-tip"
                                                        data-tooltip="Use native axios instead of TLS fingerprint requester">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="USE_NATIVE_AXIOS">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>Image Access URL</label>
                                            <input type="text" name="IMAGE_BASE_URL"
                                                placeholder="https://your-domain.zeabur.app">
                                        </div>
                                        <div class="form-group compact">
                                            <label>Proxy Address</label>
                                            <input type="text" name="PROXY" placeholder="http://127.0.0.1:7890">
                                        </div>
                                    </div>

                                    <!-- æ¨¡å‹é»˜è®¤å‚æ•° -->
                                    <div class="config-section" id="section-model">
                                        <h4>ğŸ›ï¸ Model Parameters</h4>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Temperature</label>
                                                <input type="number" step="0.1" name="DEFAULT_TEMPERATURE"
                                                    placeholder="1">
                                            </div>
                                            <div class="form-group compact">
                                                <label>Top P</label>
                                                <input type="number" step="0.01" name="DEFAULT_TOP_P" placeholder="1">
                                            </div>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Top K</label>
                                                <input type="number" name="DEFAULT_TOP_K" placeholder="50">
                                            </div>
                                            <div class="form-group compact">
                                                <label>Max Tokens</label>
                                                <input type="number" name="DEFAULT_MAX_TOKENS" placeholder="32000">
                                            </div>
                                        </div>
                                        <div class="form-group compact highlight">
                                            <label>Thinking Budget <span class="help-tip"
                                                    data-tooltip="Thinking token budget for thinking models, affects reasoning depth">?</span></label>
                                            <input type="number" name="DEFAULT_THINKING_BUDGET" placeholder="16000">
                                        </div>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>Context System <span class="help-tip"
                                                        data-tooltip="When enabled, appends user's system message to proxy prompt">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="USE_CONTEXT_SYSTEM_PROMPT"
                                                        id="useContextSystemPrompt"
                                                        onchange="handleContextSystemChange()">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>Merge Prompts <span class="help-tip"
                                                        data-tooltip="When enabled, merges all system prompts into a single part (requires Context System enabled)">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="MERGE_SYSTEM_PROMPT"
                                                        id="mergeSystemPrompt" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>Fake Non-Stream <span class="help-tip"
                                                        data-tooltip="Non-streaming requests use streaming to fetch data, return non-streaming JSON format (faster)">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="FAKE_NON_STREAM" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Official Prompt Position <span class="help-tip"
                                                        data-tooltip="Position of official prompt relative to proxy prompt">?</span></label>
                                                <select name="OFFICIAL_PROMPT_POSITION">
                                                    <option value="before">Before proxy prompt</option>
                                                    <option value="after">After proxy prompt</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>Proxy System Prompt <span class="restore-default"
                                                    onclick="restoreDefaultSystemInstruction()" title="Restore Default">â†»
                                                    Restore Default</span></label>
                                            <textarea name="SYSTEM_INSTRUCTION" rows="3"
                                                placeholder="Proxy system prompt (leave empty to disable)"></textarea>
                                        </div>
                                        <div class="form-group compact">
                                            <label>
                                                Official System Prompt <span class="help-tip" data-tooltip="Official system prompt required by AntiGravity">?</span>
                                                <span class="restore-default"
                                                    onclick="restoreDefaultOfficialSystemPrompt()" title="Restore Default"
                                                    id="restoreOfficialBtn" style="display:none;">â†» Restore Default</span>
                                            </label>
                                            <div class="textarea-wrapper">
                                                <textarea name="OFFICIAL_SYSTEM_PROMPT" id="officialSystemPrompt"
                                                    rows="5" placeholder="Official system prompt (leave empty to disable)" readonly></textarea>
                                                <div class="textarea-lock-btn" id="unlockOfficialBtn"
                                                    onclick="unlockOfficialSystemPrompt()" title="Click to unlock editing">ğŸ”’</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- è½®è¯¢ç­–ç•¥ä¸æ€§èƒ½ä¼˜åŒ– -->
                                    <div class="config-section" id="section-rotation">
                                        <h4>ğŸ”„ Polling & Performance</h4>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>Pass Signature <span class="help-tip"
                                                        data-tooltip="Pass thoughtSignature from response to client">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="PASS_SIGNATURE_TO_CLIENT">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>Fallback Signature <span class="help-tip"
                                                        data-tooltip="Use built-in default signature when no cached signature available">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="USE_FALLBACK_SIGNATURE">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>Cache All Signatures <span class="help-tip"
                                                        data-tooltip="Cache all signatures when enabled">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_ALL_SIGNATURES">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>Tool Signatures <span class="help-tip"
                                                        data-tooltip="Cache signatures when using tools">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_TOOL_SIGNATURES" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>Image Signatures <span class="help-tip"
                                                        data-tooltip="Cache signatures when using image models">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_IMAGE_SIGNATURES" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>Cache Thinking <span class="help-tip"
                                                        data-tooltip="Cache thinking content, return with signature">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_THINKING" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Strategy Mode <span class="help-tip"
                                                        data-tooltip="Load Balance: Switch token per request&#10;Quota Exhausted: Switch only when quota depleted&#10;Custom Count: Switch after specified number of requests">?</span></label>
                                                <select name="ROTATION_STRATEGY" id="rotationStrategy"
                                                    onchange="toggleRequestCountInput()">
                                                    <option value="round_robin">Load Balance</option>
                                                    <option value="quota_exhausted">Quota Exhausted Switch</option>
                                                    <option value="request_count">Custom Count</option>
                                                </select>
                                            </div>
                                            <div class="form-group compact" id="requestCountGroup">
                                                <label>Requests Per Token <span class="help-tip"
                                                        data-tooltip="In custom count mode, how many requests each token handles before switching">?</span></label>
                                                <input type="number" name="ROTATION_REQUEST_COUNT" min="1"
                                                    placeholder="10">
                                            </div>
                                        </div>
                                        <div class="rotation-status" id="rotationStatus">
                                            <span class="rotation-label">Current Status:</span>
                                            <span id="currentRotationInfo">Loading...</span>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Timeout (ms)</label>
                                                <input type="number" name="TIMEOUT" placeholder="300000">
                                            </div>
                                            <div class="form-group compact">
                                                <label>429/503 Retry Count</label>
                                                <input type="number" name="RETRY_TIMES" placeholder="0">
                                            </div>
                                        </div>

                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Heartbeat Interval (ms) <span class="help-tip"
                                                        data-tooltip="SSE heartbeat interval to prevent CF timeout disconnection">?</span></label>
                                                <input type="number" name="HEARTBEAT_INTERVAL" placeholder="15000">
                                            </div>
                                            <div class="form-group compact">
                                                <label>Memory Cleanup Interval (ms) <span class="help-tip"
                                                        data-tooltip="Fixed interval for triggering cache/object pool cleanup">?</span></label>
                                                <input type="number" name="MEMORY_CLEANUP_INTERVAL"
                                                    placeholder="1800000">
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>ğŸ”¤ Interface Font Size (px)</label>
                                            <div class="font-size-control">
                                                <input type="range" id="fontSizeRange" min="10" max="24" value="18"
                                                    oninput="changeFontSize(this.value)">
                                                <input type="number" id="fontSizeInput" min="10" max="24" value="18"
                                                    onchange="changeFontSize(this.value)" style="width: 60px;">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- å®‰å…¨ç®¡ç† -->
                                    <div class="config-section" id="section-security">
                                        <h4>ğŸ›¡ï¸ Security Management</h4>
                                        <div class="form-group compact switch-group">
                                            <label>Enable Blocking <span class="help-tip"
                                                    data-tooltip="Automatically block frequently violating IP addresses when enabled">?</span></label>
                                            <label class="switch">
                                                <input type="checkbox" id="blockingEnabled">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="security-info">
                                            <p>IP Blocking Mechanism: Automatically identify and block frequently violating IP addresses</p>
                                            <ul>
                                                <li>50 violations in 5 minutes â†’ Temporary ban for 1 hour</li>
                                                <li>10 cumulative temporary bans â†’ Permanent ban</li>
                                                <li>Internal IPs auto-whitelisted (127.x, 10.x, 172.16-31.x, 192.168.x)</li>
                                            </ul>
                                        </div>
                                        <div class="blocked-ips-header">
                                            <h5>Blocked List</h5>
                                            <button type="button" onclick="loadBlockedIPs()" class="btn btn-sm btn-info">ğŸ”„ Refresh</button>
                                        </div>
                                        <div id="blockedIPsList" class="blocked-ips-list">
                                            <div class="empty-state-small">Loading...</div>
                                        </div>
                                        <div class="whitelist-section">
                                            <h5>Whitelist Management</h5>
                                            <div class="whitelist-input-group">
                                                <input type="text" id="whitelistIPInput" placeholder="Enter IP address" />
                                                <button type="button" onclick="addWhitelistIP()" class="btn btn-sm btn-success">â• Add</button>
                                            </div>
                                            <div id="whitelistIPsList" class="whitelist-ips-list"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="config-actions">
                                    <button type="button" onclick="loadConfig()" class="btn btn-secondary">ğŸ”„
                                        Reload</button>
                                    <button type="submit" class="btn btn-success">ğŸ’¾ Save Configuration</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- æŒ‰ä¾èµ–é¡ºåºåŠ è½½æ¨¡å— -->
    <script src="js/utils.js" defer></script>
    <script src="js/ui.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/quota.js" defer></script>
    <script src="js/tokens.js" defer></script>
    <script src="js/geminicli.js" defer></script>
    <script src="js/config.js" defer></script>
    <script src="js/security.js" defer></script>
    <script src="js/logs.js" defer></script>
    <script src="js/main.js" defer></script>
</body>

</html>